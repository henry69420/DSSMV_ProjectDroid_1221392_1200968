@startuml
title UC3 - Criar Biblioteca (Create Library)
autonumber

participant "User" as User
participant "CreateLibraryActivity" as UI <<Activity>>
participant "RequestsService" as Service <<Java Class>>
participant "NetworkHandler" as Network <<Java Class>>
database "API/Backend (POST /library)" as Backend

User -> UI : Clica em "Add Library"
activate UI
User -> UI : Preenche formulário e clica em "Create Library"
UI -> UI : LibraryDto = new LibraryDto(...)
UI -> Service : postLibrary(libraryDto, callback: LibraryCallback)
activate Service
Service -> Service : ExecutorService.execute()

group Requisição Assíncrona (Background Thread)
    Service -> Service : JsonHandler.serializeLibraryDto2Json(dto)
    Service -> Network : openPostHttpConnection(url: "/library", body: JSON)
    activate Network
    Network -> Backend : HTTP POST /library (Body: JSON)
    activate Backend
    Backend --> Network : 200 OK (New LibraryDto JSON)
    deactivate Backend
    Network --> Service : JSON Response (String)
    deactivate Network
    Service -> Service : JsonHandler.deserializeJson2LibraryDto(json)

    alt Success
        Service -> UI : Handler.post(onSuccess(LibraryDto))
    else Error
        Service -> UI : Handler.post(onError(Exception))
    end
end

deactivate Service

alt Success
    UI -> User : Displays Toast("Library created successfully")
    UI -> UI : finish()
else Error
    UI -> User : Displays Toast("Update failed:...")
end

deactivate UI

@enduml