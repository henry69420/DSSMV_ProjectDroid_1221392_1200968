@startuml
title UC6 - Ver Livros Requisitados (Get Checked Out Books)
autonumber

participant "User" as User
participant "CheckedOutBooksActivity" as UI <<Activity>>
participant "RequestsService" as Service <<Java Class>>
participant "NetworkHandler" as Network <<Java Class>>
database "API/Backend (GET /user/checked-out)" as Backend

User -> UI : Insere UserId e Clica em "Search"
activate UI
UI -> UI : searchCheckedOutBooks()
UI -> UI : Salva UserId nas SharedPreferences
UI -> Service : getCheckedOutBooks(userId, callback)
activate Service
Service -> Service : ExecutorService.execute()

group Requisição Assíncrona (Background Thread)
    Service -> Network : getDataInStringFromUrl(url: "/user/checked-out?userId=...")
    activate Network
    Network -> Backend : HTTP GET /user/checked-out?userId=...
    activate Backend
    Backend --> Network : Retorna JSON (List<CheckedOutBookDto>)
    deactivate Backend
    Network --> Service : JSON Response (String)
    deactivate Network

    Service -> Service : JsonHandler.deserializeJson2ListCheckedOutBookDto(json)
    Service -> Service : Mapper.listCheckedOutBookDto2ListCheckout(dtos)

    alt Success
        Service -> UI : Handler.post(onSuccess(List<Checkout>))
    else Error
        Service -> UI : Handler.post(onError(Exception))
    end
end

deactivate Service

alt Success
    UI -> UI : booksRecyclerView.setVisibility(VISIBLE)
    UI -> User : Displays list of checkouts
else Error
    UI -> User : Displays Toast("Failed to load...")
end

deactivate UI

@enduml